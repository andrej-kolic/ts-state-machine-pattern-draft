port code from https://github.com/andrej-kolic-sm, make generic, add example hook
